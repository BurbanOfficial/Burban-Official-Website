<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Espace Client – Votre Marque de Vêtement</title>
  <!-- Utilisation de Bootstrap pour un design moderne et responsive -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <style>
    /* Styles personnalisés pour un design minimaliste, animé et convivial */
    body {
      background: #f5f5f5;
      font-family: 'Helvetica Neue', sans-serif;
      margin: 0;
      padding: 20px;
    }
    .container {
      max-width: 1200px;
      margin: auto;
    }
    h2 {
      margin-bottom: 20px;
      text-align: center;
    }
    .card {
      background: #fff;
      border-radius: 8px;
      padding: 30px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      margin-bottom: 30px;
      animation: fadeIn 1s ease-in-out;
    }
    @keyframes fadeIn {
      from {opacity: 0; transform: translateY(20px);}
      to {opacity: 1; transform: translateY(0);}
    }
    .tab-content {
      margin-top: 20px;
    }
    .progress {
      height: 25px;
    }
    .logout-btn {
      float: right;
    }
    /* Animation sur les boutons */
    .btn {
      transition: background 0.3s, transform 0.3s;
    }
    .btn:hover {
      transform: scale(1.02);
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>Espace Client – Votre Marque de Vêtement</h2>
    
    <!-- Section d'accueil pour les utilisateurs non authentifiés -->
    <div id="authButtons" class="card text-center">
      <p class="mb-4">Veuillez vous connecter ou vous inscrire pour accéder à votre espace client.</p>
      <button id="loginBtn" class="btn btn-primary me-2">Se connecter</button>
      <button id="signupBtn" class="btn btn-success">S'inscrire</button>
    </div>
    
    <!-- Tableau de bord affiché après authentification -->
    <div id="dashboard" class="card" style="display: none;">
      <button class="btn btn-secondary logout-btn" id="btn-logout">Déconnexion</button>
      <h4>Bienvenue, <span id="userName"></span></h4>
      <!-- Navigation par onglets -->
      <ul class="nav nav-tabs" id="dashboardTabs" role="tablist">
        <li class="nav-item">
          <a class="nav-link active" id="profile-tab" data-bs-toggle="tab" href="#profile" role="tab">Profile</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" id="password-tab" data-bs-toggle="tab" href="#password" role="tab">Password</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" id="email-tab" data-bs-toggle="tab" href="#emailPrefs" role="tab">Email Preferences</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" id="rewards-tab" data-bs-toggle="tab" href="#rewards" role="tab">My Burban Rewards</a>
        </li>
      </ul>
      <div class="tab-content" id="dashboardTabsContent">
        <!-- Onglet Profile -->
        <div class="tab-pane fade show active" id="profile" role="tabpanel">
          <form id="form-profile">
            <div class="mb-3">
              <label for="profileLastName" class="form-label">Nom</label>
              <input type="text" class="form-control" id="profileLastName">
            </div>
            <div class="mb-3">
              <label for="profileFirstName" class="form-label">Prénom</label>
              <input type="text" class="form-control" id="profileFirstName">
            </div>
            <div class="mb-3">
              <label for="profileEmail" class="form-label">Adresse Email</label>
              <input type="email" class="form-control" id="profileEmail">
            </div>
            <div class="mb-3">
              <label for="profilePhone" class="form-label">Numéro de téléphone</label>
              <input type="tel" class="form-control" id="profilePhone">
            </div>
            <div class="mb-3">
              <label for="profileBirthdate" class="form-label">Date de naissance</label>
              <input type="date" class="form-control" id="profileBirthdate" disabled>
              <small class="text-muted">Pour modifier votre date de naissance, merci de contacter l'assistance.</small>
            </div>
            <button type="submit" class="btn btn-primary">Enregistrer les modifications</button>
          </form>
        </div>
        <!-- Onglet Password -->
        <div class="tab-pane fade" id="password" role="tabpanel">
          <form id="form-password">
            <div class="mb-3">
              <label for="currentPassword" class="form-label">Mot de passe actuel</label>
              <input type="password" class="form-control" id="currentPassword" required>
            </div>
            <div class="mb-3">
              <label for="newPassword" class="form-label">Nouveau mot de passe</label>
              <input type="password" class="form-control" id="newPassword" required>
            </div>
            <div class="mb-3">
              <label for="confirmNewPassword" class="form-label">Confirmer le nouveau mot de passe</label>
              <input type="password" class="form-control" id="confirmNewPassword" required>
            </div>
            <button type="submit" class="btn btn-warning">Changer le mot de passe</button>
          </form>
        </div>
        <!-- Onglet Email Preferences -->
        <div class="tab-pane fade" id="emailPrefs" role="tabpanel">
          <p>Activer/désactiver l'inscription à la newsletter :</p>
          <button class="btn btn-info" id="toggleNewsletter">Toggle Newsletter</button>
        </div>
        <!-- Onglet My Burban Rewards -->
        <div class="tab-pane fade" id="rewards" role="tabpanel">
          <p>Points gagnés : <strong id="rewardPoints">0</strong> points</p>
          <div class="mb-2">
            <label class="form-label">Progression vers les remises :</label>
            <div class="progress">
              <div id="rewardProgress" class="progress-bar" role="progressbar" style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="2500"></div>
            </div>
          </div>
          <ul>
            <li>500 points = 5€ de réduction</li>
            <li>1000 points = 10€ de réduction</li>
            <li>2000 points = 20€ de réduction</li>
            <li>2500 points = 30€ de réduction</li>
          </ul>
        </div>
      </div>
    </div>
  </div>

  <!-- Chargement de Bootstrap JS et des dépendances -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <!-- Intégration du SDK Auth0 SPA -->
  <script src="https://cdn.auth0.com/js/auth0-spa-js/1.20/auth0-spa-js.production.js"></script>
  <script>
    /*************************************
     *  Configuration Auth0
     *************************************/
    const config = {
      domain: 'dev-hbhke5ujyq7rg6fn.eu.auth0.com',
      client_id: 'D8xyy3gSrrvycrP1OcuD0qVAt7HthqAG',
      redirect_uri: window.location.origin
    };

    let auth0Client = null;

    // Initialisation d'Auth0
    async function initAuth0() {
      auth0Client = await createAuth0Client({
        domain: config.domain,
        client_id: config.client_id,
        redirect_uri: config.redirect_uri
      });
      
      // Gestion de la redirection après authentification (si applicable)
      if (window.location.search.includes("code=") && window.location.search.includes("state=")) {
        await auth0Client.handleRedirectCallback();
        window.history.replaceState({}, document.title, "/");
      }
      
      updateUI();
    }

    /*************************************
     *  Gestion de l'IU (affichage de l'authentification ou du dashboard)
     *************************************/
    async function updateUI() {
      const isAuthenticated = await auth0Client.isAuthenticated();
      if(isAuthenticated) {
        // Masquer la section d'authentification et afficher le dashboard
        document.getElementById('authButtons').style.display = "none";
        document.getElementById('dashboard').style.display = "block";
        // Récupérer les informations utilisateur depuis Auth0
        const user = await auth0Client.getUser();
        document.getElementById('userName').innerText = user.given_name || user.name || user.email;
        document.getElementById('profileLastName').value = user.family_name || "";
        document.getElementById('profileFirstName').value = user.given_name || "";
        document.getElementById('profileEmail').value = user.email || "";
        document.getElementById('profileBirthdate').value = user.birthdate || "";
      } else {
        // Afficher la section d'authentification et masquer le dashboard
        document.getElementById('authButtons').style.display = "block";
        document.getElementById('dashboard').style.display = "none";
      }
    }

    /*************************************
     *  Événements pour Universal Login
     *************************************/
    // Bouton de connexion via Universal Login
    document.getElementById('loginBtn').addEventListener('click', async () => {
      try {
        await auth0Client.loginWithRedirect({
          redirect_uri: config.redirect_uri
        });
      } catch (err) {
        console.error("Erreur lors du login :", err);
      }
    });

    // Bouton d'inscription via Universal Login (screen_hint: 'signup')
    document.getElementById('signupBtn').addEventListener('click', async () => {
      try {
        await auth0Client.loginWithRedirect({
          redirect_uri: config.redirect_uri,
          screen_hint: 'signup'
        });
      } catch (err) {
        console.error("Erreur lors de l'inscription :", err);
      }
    });

    /*************************************
     *  Actions du Dashboard
     *************************************/
    // Mise à jour du profil (simulation)
    document.getElementById('form-profile').addEventListener('submit', e => {
      e.preventDefault();
      // Récupérer les valeurs modifiées
      const newLastName = document.getElementById('profileLastName').value;
      const newFirstName = document.getElementById('profileFirstName').value;
      const newEmail = document.getElementById('profileEmail').value;
      const newPhone = document.getElementById('profilePhone').value;
      alert("Profil mis à jour. Si l'adresse email a changé, un email de confirmation sera envoyé.");
      // Vous devez envoyer ces modifications vers votre backend/Auth0 Management API.
    });

    // Changement de mot de passe (simulation)
    document.getElementById('form-password').addEventListener('submit', e => {
      e.preventDefault();
      const currentPassword = document.getElementById('currentPassword').value;
      const newPassword = document.getElementById('newPassword').value;
      const confirmNewPassword = document.getElementById('confirmNewPassword').value;
      if(newPassword !== confirmNewPassword) {
        alert("Les nouveaux mots de passe ne correspondent pas.");
        return;
      }
      alert("Mot de passe modifié. Un email de confirmation vous a été envoyé.");
      // Envoyer la demande de changement de mot de passe via votre backend/Auth0 Management API.
    });

    // Toggle Newsletter (simulation)
    document.getElementById('toggleNewsletter').addEventListener('click', e => {
      alert("Votre abonnement à la newsletter a été mis à jour.");
    });

    // Déconnexion
    document.getElementById('btn-logout').addEventListener('click', e => {
      auth0Client.logout({
        returnTo: window.location.origin
      });
    });

    /*************************************
     *  Simulation de points de récompense
     *************************************/
    let currentPoints = 750;
    document.getElementById('rewardPoints').innerText = currentPoints;
    const progressPercent = (currentPoints / 2500) * 100;
    document.getElementById('rewardProgress').style.width = progressPercent + "%";

    window.onload = initAuth0;
  </script>
</body>
</html>
